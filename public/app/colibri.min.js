!function(){angular.module("AlertModule",[]),angular.module("NavigationModule",[]),angular.module("LoginModule",[]),angular.module("EventModule",[]),angular.module("TerminalModule",[]);var e=angular.module("myAPP",["ngRoute","ngStorage","720kb.tooltips","AlertModule","LoginModule","EventModule","TerminalModule","NavigationModule"]);e.constant("config",{getEventURL:"/events/getEvents",addEventURL:"/events/addEvent",editEventURL:"/events/editEvent",deleteEventURL:"/events/deleteEvent",getTerminalsURL:"/terminals/getTerminals",getTerminalURL:"/terminals/getTerminal",editCranesURL:"/cranes/editEventCranes",loginUserURL:"/users/login"}),e.config(["$logProvider",function(e){e.debugEnabled(!0)}]),e.config(["$httpProvider",function(e){e.interceptors.push(["$q","$location","$log","$localStorage",function(e,t,n,r){return{request:function(e){return n.debug("Intersected"),e.headers=e.headers||{},e.headers.Accept="application/json",r.userToken&&(e.headers.Authorization="Bearer "+r.userToken),n.debug("Config Headers After:"+JSON.stringify(e.headers)),e},responseError:function(n){return(401===n.status||403===n.status)&&t.path("/"),e.reject(n)}}}])}]),e.factory("_",[function(){return window._}]),e.config(["$routeProvider",function(e){e.when("/events/:terminalId",{templateUrl:"app/events/events.html",controller:"EventController"}).when("/terminals",{templateUrl:"app/terminals/terminals.html",controller:"TerminalController"}).when("/",{templateUrl:"app/login/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}])}(),function(){var e=angular.module("EventModule");e.controller("EventController",["$http","$log","$scope","$routeParams","config","alertService","_",function(e,t,n,r,a,o,i){function s(){e.get(a.getEventURL+"/"+g).success(function(e){t.debug("Received Events:"+JSON.stringify(e)),e.message?(t.debug("Error getting events"),o.pushMessage(e)):n.events=e}).error(function(){o.pushMessage("Connection Error")})}function u(e){for(var r=new Object,a=0,o=0;o<e.length;o++){var i=e[o];i.berthStart&&(r[i.berthId]={sumLength:a,berthName:i.berthName,berthId:i.berthId}),a+=i.berthLength}n.terminal.mainBerths=r,t.debug("Modified Terminal:"+JSON.stringify(n.terminal))}function d(e){for(var n=e.totalLength,r=999,a=0;a<e.berths.length;a++){var o=e.berths[a];o.pixelLength=r/n*o.berthLength}t.debug("New Terminal Data:"+JSON.stringify(e))}function l(){e.get(a.getTerminalURL+"/"+g).success(function(e){t.debug("Terminal Info Received:"+JSON.stringify(e)),e.type?o.pushMessage(e):(d(e),n.terminal=e,e.berths?(u(e.berths),s(),n.calendarLoaded=!0):o.pushMessage("Unable to load events"))}).error(function(){o.pushMessage("Connection Error")})}function v(){l()}var g=r.terminalId;t.debug("TERMINAL ID:"+g),n.events=[],n.terminal="",n.hours=["1","2","3","4","5","6","7","8","9","10","11","12"],n.days=[{dayId:1,dayName:"Monday"},{dayId:2,dayName:"Tuesday"},{dayId:3,dayName:"Wednesday"},{dayId:4,dayName:"Thursday"},{dayId:5,dayName:"Friday"},{dayId:6,dayName:"Saturday"},{dayId:7,dayName:"Sunday"}],n.editable=!1,n.newEvent="",n.cranesList=[],n.calendarLoaded=!1,v(),n.addNewEvent=function(r){if(t.debug("New Event"),n.eventForm.$invalid)return t.debug("Invalid Form"),void(n.eventForm.showValidation=!0);var i=angular.copy(r);t.debug("Event to Add:"+JSON.stringify(i));var s={eventName:r.eventName,eventArrivingTime:r.eventArrivingTime,eventDuration:r.eventDuration,eventStart:r.eventStart,eventLength:r.eventLength,eventDay:r.eventDay,berthId:r.berthId,terminalId:g};e.post(a.addEventURL,s).success(function(e){t.debug("Add Event Received Data:"+JSON.stringify(e)),e.message?o.pushMessage(e):(n.events.push(e),$("#eventModal").modal("hide"),n.newEvent="")}).error(function(){o.pushMessage("Connection Error")})},n.changeButton=function(){t.debug("Changing Form button"),n.editable=!1,n.eventForm.$setPristine(),n.newEvent=""},n.editEvent=function(r){if(t.debug("Edit Event"),t.debug("Edited Event:"+JSON.stringify(r)),n.eventForm.$invalid)return t.debug("Form is Invalid"),void(n.eventForm.showValidation=!0);var i={eventName:r.eventName,eventArrivingTime:r.eventArrivingTime,eventDuration:r.eventDuration,eventStart:r.eventStart,eventLength:r.eventLength,eventDay:r.eventDay,eventId:r.eventId,berthId:r.berthId,terminalId:g};e.post(a.editEventURL,i).success(function(e){t.debug("Received Edit Data:"+JSON.stringify(e)),s()}).error(function(){o.pushMessage("Connection Error")}),n.eventChange=n.eventChange?!1:!0,n.newEvent={}},n.editEventModal=function(e){t.debug("Edit Event Modal"),t.debug("Event to edit:"+JSON.stringify(e)),n.newEvent=angular.copy(e),n.editable=!0},n.deleteEvent=function(n){t.debug("Delete Event"),t.debug(n),e.post(a.deleteEventURL,{eventId:n.eventId}).success(function(e){t.debug("Received Delete Data:"+JSON.stringify(e)),s()}).error(function(){o.pushMessage("Connection Error")})},n.updateEvents=function(){t.debug("Update Events"),s()},n.moveEvent=function(n){t.debug("Move Event"),t.debug("Moved Event: "+JSON.stringify(n));var r={eventName:n.eventName,eventArrivingTime:n.eventArrivingTime,eventDuration:n.eventDuration,eventStart:n.eventStart,eventLength:n.eventLength,eventDay:n.eventDay,eventId:n.eventId,berthId:n.berthId};e.post(a.editEventURL,r).success(function(e){t.debug("Received Edit Data:"+JSON.stringify(e))}).error(function(){o.pushMessage("Connection Error")})},n.editCranesModal=function(e){t.debug("Edit Cranes Modal:"+JSON.stringify(e));var r=[],a=n.terminal.cranes,o=e.eventCranes;n.newEvent=e;for(var s=[],u=0;u<o.length;u++){var d=o[u];r.push(d.craneId)}t.debug("Terminal Cranes:"+JSON.stringify(a));for(var l=0;l<a.length;l++){var v=a[l],g=!1;i.contains(r,v.craneId)&&(g=!0);var c={craneId:v.craneId,craneName:v.craneName,value:g};s.push(c)}t.debug("Crane Final List:"+JSON.stringify(s)),n.cranesList=s},n.editCranes=function(r){t.debug("Edit Cranes:"+JSON.stringify(r));for(var i=n.newEvent,u={eventId:i.eventId},d=[],l=0;l<r.length;l++){var v=r[l];v.value&&d.push({craneId:v.craneId})}u.cranes=d,t.debug("JSON to Send:"+JSON.stringify(u));var g={json:JSON.stringify(u)};e.post(a.editCranesURL,g).success(function(e){t.debug("Received Edit Crane Data:"+JSON.stringify(e)),$("#craneModal").modal("hide"),s()}).error(function(){o.pushMessage("Connection Error")})}}])}(),function(){function e(){}function t(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function n(t,n){var r=n.totalLength;t.eventStart=t.eventStart+n.mainBerths[t.berthId].sumLength;var a=t.eventArrivingTime.split(":"),c=parseInt(a[0],10),f=parseInt(a[1],10),m=(t.eventDay-1)*o+i/v*c+s,h=(t.eventDay-1)*o+i/v*(c+t.eventDuration)+s,p=f/g*l;m+=p,h+=p;var E=t.eventStart*(d-u)/r+u,b=(t.eventStart+t.eventLength)*(d-u)/r+u,y=new e;return y.top=m,y.left=E,y.width=b-E,y.height=h-m,y}function r(e,n){var r=e.left,a=e.top,l=n.totalLength,c=(r-u)*(l/(d-u)),f=Math.ceil((a-s)/o),m=(a-s)%o*(v/i),h=parseInt(100*(m-parseInt(m))),p=h/100*g,E=t(parseInt(m,10),2)+":"+t(parseInt(p,10),2),b="";for(var y in n.mainBerths){var S=n.mainBerths[y].sumLength;c>=S&&(b=y)}c-=n.mainBerths[b].sumLength;var N={eventStart:c,eventDay:f,eventArrivingTime:E,berthId:b};return N}var a=angular.module("EventModule"),o=84,i=83,s=29,u=100,d=1099,l=3.5,v=24,g=60;a.directive("tableGen",function(){return{restrict:"E",templateUrl:"./app/events/table.html",replace:!0}}),a.directive("event",["$log","$document",function(e,t){return{restrict:"E",templateUrl:"./app/events/event.html",replace:!0,transclude:!0,link:function(a,o){function i(e){v=e.pageY-d,l=e.pageX-u,o.css({top:v+"px",left:l+"px"})}function s(){t.off("mousemove",i),t.off("mouseup",s);var n={left:l,top:v},o=r(n,a.terminal);a.event.eventDay=o.eventDay,a.event.eventStart=parseInt(o.eventStart),a.event.eventArrivingTime=o.eventArrivingTime,a.event.berthId=o.berthId,a.moveEvent(a.event),a.$apply(),e.debug("New scope event:"+JSON.stringify(a.event))}var u=0,d=0,l=0,v=0;a.$watch("eventChange",function(){e.debug("Event Change:"+JSON.stringify(a.event));var t=angular.copy(a.event),r=n(t,a.terminal);e.debug("AFTER CSS SCOPE EVENT:"+JSON.stringify(a.event)),o.css({width:r.width,height:r.height,top:r.top,left:r.left}),u=r.left,d=r.top,l=r.left,v=r.top}),o.on("mousedown",function(e){"resizer"!=e.target.className&&(e.preventDefault(),d=e.pageY-v,u=e.pageX-l,t.on("mousemove",i),t.on("mouseup",s))})}}}]),a.directive("resizer",["$document","$log",function(e,t){return{restrict:"A",link:function(n,r){function a(e){var n=e.pageY-u+s;t.debug("New Height:"+n)}function o(){e.unbind("mousemove",a),e.unbind("mouseup",o)}var i=parseInt($(r).parent().css("top"),10),s=parseInt($(r).parent().css("height"),10),u=i+s;r.on("mousedown",function(t){t.preventDefault(),u=t.pageY-u,e.on("mousemove",a),e.on("mouseup",o)})}}}])}(),function(){var e=angular.module("LoginModule");e.controller("LoginController",["$http","$log","$scope","$routeParams","config","$rootScope","_","$location","$localStorage",function(e,t,n,r,a,o,i,s,u){n.loginUser="",n.showPage=!1,u.userToken&&""!=u.userToken?s.path("/terminals"):n.showPage=!0,n.login=function(n){t.debug("Login with:"+JSON.stringify(n));var r={userEmail:n.email,userPassword:n.password};e.post(a.loginUserURL,r).success(function(e){t.debug("Received Edit Data:"+JSON.stringify(e)),e.userToken&&""!=e.userToken&&(u.userToken=e.userToken,s.path("/terminals"))}).error(function(){t.debug("Error")})}}])}(),function(){var e=angular.module("TerminalModule");e.controller("TerminalController",["$http","$log","$scope","$routeParams","config","alertService",function(e,t,n,r,a,o){function i(){e.get(a.getTerminalsURL).success(function(e){t.debug("Received Terminals:"+JSON.stringify(e)),e.type?o.pushMessage(e):n.terminals=e}).error(function(){o.pushMessage("Connexion Refused")})}n.terminals=[],i()}])}(),function(){var e=angular.module("AlertModule");e.directive("alertsDisplay",["$log",function(e){return{restrict:"E",templateUrl:"./app/shared/alerts/alerts.html",replace:!0,controller:["$scope",function(t){t.errorMessage="",t.showError=!1,t.$on("AlertEvent",function(n,r){e.debug("AlertEvent Call:"+r),t.showError=!1,t.showError=!0,t.errorMessage=r})}]}}])}(),function(){var e=angular.module("AlertModule");e.service("alertService",["$log","$rootScope",function(e,t){this.pushMessage=function(n){e.debug("Alert Message:"+n),e.error("Error:"+JSON.stringify(n)),n.message?t.$broadcast("AlertEvent",n.message):t.$broadcast("AlertEvent",n)}}])}(),function(){var e=angular.module("NavigationModule");e.directive("navigationBar",["$log","$document","$localStorage","$location",function(e,t,n,r){return{restrict:"E",templateUrl:"./app/shared/navigation/navigation.html",replace:!0,controller:["$scope",function(t){t.logout=function(){e.debug("Logout"),delete n.userToken,r.path("/")}}]}}])}();