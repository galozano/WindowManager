!function(){angular.module("AlertModule",[]),angular.module("NavigationModule",[]),angular.module("LoginModule",[]),angular.module("EventModule",[]),angular.module("TerminalModule",[]),angular.module("UserModule",[]);var e=angular.module("myAPP",["ngRoute","ngStorage","720kb.tooltips","AlertModule","LoginModule","EventModule","TerminalModule","NavigationModule","UserModule"]);e.constant("config",{getEventURL:"/events/getEvents",addEventURL:"/events/addEvent",editEventURL:"/events/editEvent",deleteEventURL:"/events/deleteEvent",getTerminalsURL:"/terminals/getTerminals",getTerminalURL:"/terminals/getTerminal",editCranesURL:"/cranes/editEventCranes",loginUserURL:"/users/login",changePasswordURL:"/users/password"}),e.config(["$logProvider",function(e){e.debugEnabled(!0)}]),e.config(["$httpProvider",function(e){e.interceptors.push(["$q","$location","$log","$sessionStorage","alertService",function(e,n,t,r,a){return{request:function(e){return t.debug("Intersected"),e.headers=e.headers||{},e.headers.Accept="application/json",r.userToken&&(e.headers.Authorization="Bearer "+r.userToken),t.debug("Config Headers After:"+JSON.stringify(e.headers)),e},responseError:function(t){return 401===t.status||403===t.status?n.path("/"):t.code&&a.pushMessage(t),e.reject(t)}}}])}]),e.factory("_",[function(){return window._}]),e.config(["$routeProvider",function(e){e.when("/events/:terminalId",{templateUrl:"app/events/events.html",controller:"EventController"}).when("/terminals",{templateUrl:"app/terminals/terminals.html",controller:"TerminalController"}).when("/user",{templateUrl:"app/user/user.html",controller:"UserController"}).when("/",{templateUrl:"app/login/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}])}(),function(){var e=angular.module("EventModule");e.controller("EventController",["$http","$log","$scope","$routeParams","config","alertService","_",function(e,n,t,r,a,o,s){function i(){e.get(a.getEventURL+"/"+g).success(function(e){n.debug("Received Events:"+JSON.stringify(e)),e.message?(n.debug("Error getting events"),o.pushMessage(e)):t.events=e}).error(function(){o.pushMessage("Connection Error")})}function u(e){for(var r=new Object,a=0,o=0;o<e.length;o++){var s=e[o];s.berthStart&&(r[s.berthId]={sumLength:a,berthName:s.berthName,berthId:s.berthId}),a+=s.berthLength}t.terminal.mainBerths=r,n.debug("Modified Terminal:"+JSON.stringify(t.terminal))}function d(e){for(var t=e.totalLength,r=999,a=0;a<e.berths.length;a++){var o=e.berths[a];o.pixelLength=r/t*o.berthLength}n.debug("New Terminal Data:"+JSON.stringify(e))}function l(){e.get(a.getTerminalURL+"/"+g).success(function(e){n.debug("Terminal Info Received:"+JSON.stringify(e)),e.type?o.pushMessage(e):(d(e),t.terminal=e,e.berths?(u(e.berths),i(),t.calendarLoaded=!0):o.pushMessage("Unable to load events"))}).error(function(){o.pushMessage("Connection Error")})}function v(){l()}var g=r.terminalId;n.debug("TERMINAL ID:"+g),t.events=[],t.terminal="",t.hours=["1","2","3","4","5","6","7","8","9","10","11","12"],t.days=[{dayId:1,dayName:"Monday"},{dayId:2,dayName:"Tuesday"},{dayId:3,dayName:"Wednesday"},{dayId:4,dayName:"Thursday"},{dayId:5,dayName:"Friday"},{dayId:6,dayName:"Saturday"},{dayId:7,dayName:"Sunday"}],t.editable=!1,t.newEvent="",t.cranesList=[],t.calendarLoaded=!1,v(),t.addNewEvent=function(r){if(n.debug("New Event"),t.eventForm.$invalid)return n.debug("Invalid Form"),void(t.eventForm.showValidation=!0);var s=angular.copy(r);n.debug("Event to Add:"+JSON.stringify(s));var i={eventName:r.eventName,eventArrivingTime:r.eventArrivingTime,eventDuration:r.eventDuration,eventStart:r.eventStart,eventLength:r.eventLength,eventDay:r.eventDay,berthId:r.berthId,terminalId:g};e.post(a.addEventURL,i).success(function(e){n.debug("Add Event Received Data:"+JSON.stringify(e)),e.message?o.pushMessage(e):(t.events.push(e),$("#eventModal").modal("hide"),t.newEvent="")}).error(function(){o.pushMessage("Connection Error")})},t.changeButton=function(){n.debug("Changing Form button"),t.editable=!1,t.eventForm.$setPristine(),t.newEvent=""},t.editEvent=function(r){if(n.debug("Edit Event"),n.debug("Edited Event:"+JSON.stringify(r)),t.eventForm.$invalid)return n.debug("Form is Invalid"),void(t.eventForm.showValidation=!0);var s={eventName:r.eventName,eventArrivingTime:r.eventArrivingTime,eventDuration:r.eventDuration,eventStart:r.eventStart,eventLength:r.eventLength,eventDay:r.eventDay,eventId:r.eventId,berthId:r.berthId,terminalId:g};e.post(a.editEventURL,s).success(function(e){n.debug("Received Edit Data:"+JSON.stringify(e)),i()}).error(function(){o.pushMessage("Connection Error")}),t.eventChange=t.eventChange?!1:!0,t.newEvent={}},t.editEventModal=function(e){n.debug("Edit Event Modal"),n.debug("Event to edit:"+JSON.stringify(e)),t.newEvent=angular.copy(e),t.editable=!0},t.deleteEvent=function(t){n.debug("Delete Event"),n.debug(t),e.post(a.deleteEventURL,{eventId:t.eventId}).success(function(e){n.debug("Received Delete Data:"+JSON.stringify(e)),i()}).error(function(){o.pushMessage("Connection Error")})},t.updateEvents=function(){n.debug("Update Events"),i()},t.moveEvent=function(t){n.debug("Move Event"),n.debug("Moved Event: "+JSON.stringify(t));var r={eventName:t.eventName,eventArrivingTime:t.eventArrivingTime,eventDuration:t.eventDuration,eventStart:t.eventStart,eventLength:t.eventLength,eventDay:t.eventDay,eventId:t.eventId,berthId:t.berthId};e.post(a.editEventURL,r).success(function(e){n.debug("Received Edit Data:"+JSON.stringify(e))}).error(function(){o.pushMessage("Connection Error")})},t.editCranesModal=function(e){n.debug("Edit Cranes Modal:"+JSON.stringify(e));var r=[],a=t.terminal.cranes,o=e.eventCranes;t.newEvent=e;for(var i=[],u=0;u<o.length;u++){var d=o[u];r.push(d.craneId)}n.debug("Terminal Cranes:"+JSON.stringify(a));for(var l=0;l<a.length;l++){var v=a[l],g=!1;s.contains(r,v.craneId)&&(g=!0);var c={craneId:v.craneId,craneName:v.craneName,value:g};i.push(c)}n.debug("Crane Final List:"+JSON.stringify(i)),t.cranesList=i},t.editCranes=function(r){n.debug("Edit Cranes:"+JSON.stringify(r));for(var s=t.newEvent,u={eventId:s.eventId},d=[],l=0;l<r.length;l++){var v=r[l];v.value&&d.push({craneId:v.craneId})}u.cranes=d,n.debug("JSON to Send:"+JSON.stringify(u));var g={json:JSON.stringify(u)};e.post(a.editCranesURL,g).success(function(e){n.debug("Received Edit Crane Data:"+JSON.stringify(e)),$("#craneModal").modal("hide"),i()}).error(function(){o.pushMessage("Connection Error")})}}])}(),function(){function e(){}function n(e,n){for(var t=e+"";t.length<n;)t="0"+t;return t}function t(n,t){var r=t.totalLength;n.eventStart=n.eventStart+t.mainBerths[n.berthId].sumLength;var a=n.eventArrivingTime.split(":"),c=parseInt(a[0],10),m=parseInt(a[1],10),f=(n.eventDay-1)*o+s/v*c+i,h=(n.eventDay-1)*o+s/v*(c+n.eventDuration)+i,p=m/g*l;f+=p,h+=p;var E=n.eventStart*(d-u)/r+u,b=(n.eventStart+n.eventLength)*(d-u)/r+u,y=new e;return y.top=f,y.left=E,y.width=b-E,y.height=h-f,y}function r(e,t){var r=e.left,a=e.top,l=t.totalLength,c=(r-u)*(l/(d-u)),m=Math.ceil((a-i)/o),f=(a-i)%o*(v/s),h=parseInt(100*(f-parseInt(f))),p=h/100*g,E=n(parseInt(f,10),2)+":"+n(parseInt(p,10),2),b="";for(var y in t.mainBerths){var S=t.mainBerths[y].sumLength;c>=S&&(b=y)}c-=t.mainBerths[b].sumLength;var w={eventStart:c,eventDay:m,eventArrivingTime:E,berthId:b};return w}var a=angular.module("EventModule"),o=84,s=83,i=29,u=100,d=1099,l=3.5,v=24,g=60;a.directive("tableGen",function(){return{restrict:"E",templateUrl:"./app/events/table.html",replace:!0}}),a.directive("event",["$log","$document",function(e,n){return{restrict:"E",templateUrl:"./app/events/event.html",replace:!0,transclude:!0,link:function(a,o){function s(e){v=e.pageY-d,l=e.pageX-u,o.css({top:v+"px",left:l+"px"})}function i(){n.off("mousemove",s),n.off("mouseup",i);var t={left:l,top:v},o=r(t,a.terminal);a.event.eventDay=o.eventDay,a.event.eventStart=parseInt(o.eventStart),a.event.eventArrivingTime=o.eventArrivingTime,a.event.berthId=o.berthId,a.moveEvent(a.event),a.$apply(),e.debug("New scope event:"+JSON.stringify(a.event))}var u=0,d=0,l=0,v=0;a.$watch("eventChange",function(){e.debug("Event Change:"+JSON.stringify(a.event));var n=angular.copy(a.event),r=t(n,a.terminal);e.debug("AFTER CSS SCOPE EVENT:"+JSON.stringify(a.event)),o.css({width:r.width,height:r.height,top:r.top,left:r.left}),u=r.left,d=r.top,l=r.left,v=r.top}),o.on("mousedown",function(e){"resizer"!=e.target.className&&(e.preventDefault(),d=e.pageY-v,u=e.pageX-l,n.on("mousemove",s),n.on("mouseup",i))})}}}]),a.directive("resizer",["$document","$log",function(e,n){return{restrict:"A",link:function(t,r){function a(e){var t=e.pageY-u+i;n.debug("New Height:"+t)}function o(){e.unbind("mousemove",a),e.unbind("mouseup",o)}var s=parseInt($(r).parent().css("top"),10),i=parseInt($(r).parent().css("height"),10),u=s+i;r.on("mousedown",function(n){n.preventDefault(),u=n.pageY-u,e.on("mousemove",a),e.on("mouseup",o)})}}}])}(),function(){var e=angular.module("LoginModule");e.controller("LoginController",["$http","$log","$scope","$routeParams","config","$rootScope","_","$location","$sessionStorage",function(e,n,t,r,a,o,s,i,u){t.loginUser="",t.showPage=!1,t.formError="",u.userToken&&""!=u.userToken?i.path("/terminals"):t.showPage=!0,t.login=function(r){n.debug("Login with:"+JSON.stringify(r));var o={userEmail:r.email,userPassword:r.password};e.post(a.loginUserURL,o).success(function(e){n.debug("Received Edit Data:"+JSON.stringify(e)),e.userToken&&""!=e.userToken?(u.userToken=e.userToken,u.userEmail=e.userEmail,i.path("/terminals")):t.formError="Invalid email or password"}).error(function(){n.debug("Error")})}}])}(),function(){var e=angular.module("TerminalModule");e.controller("TerminalController",["$http","$log","$scope","$routeParams","config","alertService",function(e,n,t,r,a,o){function s(){e.get(a.getTerminalsURL).success(function(e){n.debug("Received Terminals:"+JSON.stringify(e)),e.type?o.pushMessage(e):t.terminals=e}).error(function(){o.pushMessage("Connexion Refused")})}t.terminals=[],s()}])}(),function(){var e=angular.module("UserModule");e.controller("UserController",["$http","$log","$scope","$routeParams","config","alertService","$sessionStorage",function(e,n,t,r,a,o,s){t.newUser="",t.formError="",t.changePassword=function(r){if(n.debug("Change Password"),t.changePasswordForm.$invalid)return n.debug("Invalid Form"),void(t.changePasswordForm.showValidation=!0);if(r.newPassword!=r.confirmPassword)return void(t.formError="Confirm Password is not the same as new Password");var i={userEmail:s.userEmail,oldPassword:r.oldPassword,newPassword:r.newPassword};e.post(a.changePasswordURL,i).success(function(e){e.code?o.pushMessage(e):o.pushSuccessMessage("Password changed")}).fail(function(){o.pushMessage("Connection Error")})}}])}(),function(){var e=angular.module("AlertModule");e.directive("alertsDisplay",["$log",function(e){return{restrict:"E",templateUrl:"./app/shared/alerts/alerts.html",replace:!0,controller:["$scope",function(n){n.errorMessage="",n.showError=!1,n.showSuccess=!1,n.successMessage="",n.$on("AlertEvent",function(t,r){e.debug("AlertEvent Call:"+r),n.showError=!1,n.showError=!0,n.errorMessage=r}),n.$on("SuccessMessage",function(t,r){e.debug("Success Message Call:"+r),n.showSuccess=!0,n.successMessage=r})}]}}])}(),function(){var e=angular.module("AlertModule");e.service("alertService",["$log","$rootScope",function(e,n){this.pushMessage=function(t){e.debug("Alert Message:"+t),e.error("Error:"+JSON.stringify(t)),t.message?n.$broadcast("AlertEvent",t.message):n.$broadcast("AlertEvent",t)},this.pushSuccessMessage=function(t){e.debug("Success Message:"+t),n.$broadcast("SuccessMessage",t)}}])}(),function(){var e=angular.module("NavigationModule");e.directive("navigationBar",["$log","$document","$sessionStorage","$location",function(e,n,t,r){return{restrict:"E",templateUrl:"./app/shared/navigation/navigation.html",replace:!0,controller:["$scope",function(n){n.logout=function(){e.debug("Logout"),delete t.userToken,r.path("/")}}]}}])}();